<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç™»å…¥ç³»çµ± - SmartEdu è£œç¿’ç¤¾</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded shadow-lg w-full max-w-md">
      <h1 class="text-2xl font-bold mb-6 text-center text-blue-700">
        ğŸ” SmartEdu ç™»å…¥ç³»çµ±
      </h1>

      <form id="loginForm" class="space-y-4">
        <div>
          <label for="username" class="block text-gray-700 font-medium mb-1"
            >å¸³è™Ÿ</label
          >
          <input
            id="username"
            name="username"
            type="text"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>

        <div>
          <label for="password" class="block text-gray-700 font-medium mb-1"
            >å¯†ç¢¼</label
          >
          <input
            id="password"
            name="password"
            type="password"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition"
        >
          ç™»å…¥
        </button>
      </form>

      <p id="errorMessage" class="text-red-600 text-center mt-4 hidden"></p>

      <!-- é è¨­å¸³è™Ÿæç¤º -->
      <div class="mt-6 p-4 bg-gray-50 rounded text-sm text-gray-600">
        <p class="font-semibold mb-2">é è¨­æ¸¬è©¦å¸³è™Ÿï¼š</p>
        <p>ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡ - å¸³è™Ÿ: admin, å¯†ç¢¼: admin123</p>
        <p>ğŸ‘¨â€ğŸ« æ•™å¸« - å¸³è™Ÿ: teacher1, å¯†ç¢¼: teacher123</p>
        <p>ğŸ‘¨â€ğŸ“ å­¸ç”Ÿ - å¸³è™Ÿ: student1, å¯†ç¢¼: student123</p>
      </div>
    </div>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();
          const errorMsg = document.getElementById("errorMessage");

          errorMsg.classList.add("hidden");

          try {
            const res = await fetch("/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            const data = await res.json();
            console.log("ç™»å…¥å›æ‡‰:", data);

            if (data.success) {
              // æ¸…é™¤æ­·å²è¨˜éŒ„ï¼Œé˜²æ­¢è¿”å›
              if (window.history && window.history.replaceState) {
                window.history.replaceState(null, null, "/");
              }

              // æ ¹æ“šè§’è‰²è·³è½‰åˆ°ä¸åŒé é¢
              if (data.role === "admin") {
                window.location.replace("/admin");
              } else if (data.role === "teacher") {
                window.location.replace("/teacher");
              } else if (data.role === "student") {
                window.location.replace("/student");
              } else {
                window.location.replace("/dashboard.html");
              }
            } else {
              errorMsg.textContent =
                data.message || "ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥å¸³è™Ÿæˆ–å¯†ç¢¼ã€‚";
              errorMsg.classList.remove("hidden");
            }
          } catch (err) {
            console.error("ç™»å…¥éŒ¯èª¤:", err);
            errorMsg.textContent = "ä¼ºæœå™¨é€£æ¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            errorMsg.classList.remove("hidden");
          }
        });
    </script>
  </body>
</html>
